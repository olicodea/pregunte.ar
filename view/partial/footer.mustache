</main>
<footer class="text-white flex items-center justify-center w-full">
    <p class="text-center">2023 - Pregunte.ar - Programaci√≥n Web 2</p>
</footer>

{{> script }}

{{#ApiGoogleMaps}}
    <script src="https://maps.googleapis.com/maps/api/js?key={{ApiGoogleMaps}}&callback=initMap" async defer></script>
{{/ApiGoogleMaps}}

{{#ApiGoogleMapsPerfil}}
    <script src="https://maps.googleapis.com/maps/api/js?key={{ApiGoogleMapsPerfil}}&callback=perfilMapa" async defer></script>
{{/ApiGoogleMapsPerfil}}

{{#preguntas}}
    <script>
        async function findRespuestas(idRespuesta) {
            return new Promise(function (resolve, reject) {
                $.ajax({
                    url: '/preguntasSugeridas/findRespuestas&idRespuesta=' + idRespuesta,
                    method: 'GET',
                    success: function (response) {
                        resolve(response);
                    },
                    error: function (xhr, status, error) {
                        console.log('Error al enviar los datos al servidor');
                        reject(error);
                    }
                });
            });
        }

        async function mostrarModal(idPregunta, pregunta, usuario, idRespuesta) {
            const modal = document.getElementById('modal');
            modal.classList.remove('hidden');

            const modalTitle = document.getElementById('modal-title');
            modalTitle.textContent = `Pregunta sugerida por ${usuario}`;

            const modalQuestion = document.getElementById('modal-question');
            modalQuestion.textContent = pregunta;

            const modalAnswers = document.getElementById('modal-answers');
            modalAnswers.textContent = "";

            const inputIdPreguntaHidden = document.createElement("input");
            inputIdPreguntaHidden.type = "hidden";
            inputIdPreguntaHidden.id = "inputIdPreguntaHidden";
            inputIdPreguntaHidden.value = idPregunta;
            modalQuestion.append(inputIdPreguntaHidden);

            let respuestas = await findRespuestas(idRespuesta);
            insertarRespuestas(modalAnswers, respuestas);

            modal.addEventListener('click', function(event) {
                if (event.target === document.querySelector('.modal-overlay')) {
                    cancelarModal();
                }
            });
        }

         function aprobarPregunta() {
             const inputIdHidden = document.getElementById('inputIdPreguntaHidden');
             const idPregunta = inputIdHidden.value;

             return new Promise(function (resolve, reject) {
                 $.ajax({
                     url: '/preguntasSugeridas/aprobarPregunta',
                     method: 'POST',
                     data: {
                         idPregunta: idPregunta
                     },
                     success: function (response) {
                         console.log(response)
                         resolve(response);
                     },
                     error: function (xhr, status, error) {
                         console.log('Error al enviar los datos al servidor');
                         reject(error);
                     }
                 });
                 cancelarModal();
             });
        }

        function rechazarPregunta() {
            const inputIdHidden = document.getElementById('inputIdPreguntaHidden');
            const idPregunta = inputIdHidden.value;

            return new Promise(function (resolve, reject) {
                $.ajax({
                    url: '/preguntasSugeridas/rechazarPregunta',
                    method: 'POST',
                    data: {
                        idPregunta: idPregunta
                    },
                    success: function (response) {
                        console.log(response)
                        resolve(response);
                    },
                    error: function (xhr, status, error) {
                        console.log('Error al enviar los datos al servidor');
                        reject(error);
                    }
                });
                cancelarModal();
            });
        }

        function cancelarModal() {
            const modal = document.getElementById('modal');
            modal.classList.add('hidden');
        }

        function insertarRespuestas(modalAnswers, respuestas) {
            Object.values(respuestas).forEach(respuesta => {
                const li = document.createElement("li");
                li.textContent = respuesta.respuesta;
                if(respuesta.esCorrecta) {
                    li.textContent += " - " + "RESPUESTA CORRECTA";
                }
                modalAnswers.append(li);
            })
        }
    </script>
{{/preguntas}}

</body>
</html>